
\newif\ifNativeUtfEightPatterns
\begingroup
\def\testengine#1#2!{\def\secondarg{#2}}%
\testengine Ï‡!\relax % That's Chi, a 2-byte utf-8 sequence
\ifx\secondarg\empty
  \message{Using a TeX engine with native UTF-8 support.}%
  \aftergroup\NativeUtfEightPatternstrue
\else
  \message{Using an 8-bit TeX engine.}%
\fi
\endgroup

\ifNativeUtfEightPatterns
  \def\loadhyphpatterns#1#2{\obeylines
        \expandafter\read@patterns\@@input hyph-#1.pat \egroup}
\else
  \def\loadhyphpatterns#1#2{\@@input conv_utf8_#2.tex
        \obeylines
        \expandafter\read@patterns\@@input hyph-#1.pat \egroup}
\fi

\def\utf@eight@name{UTF-8}
\begingroup
  \obeylines%
  \gdef\read@patterns #1^^M{\def\encname{#1}%
    \ifx\encname\utf@eight@name\else%
      \errmessage{Pattern file must begin with encoding name "UTF-8", found "\encname"}%
    \fi \catcode13=10 \patterns\bgroup}%
\endgroup

